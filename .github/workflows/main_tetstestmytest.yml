name: Build and deploy Node.js

on: [push]

env:
  AZURE_WEBAPP_NAME: FaultCodeMgt-Admin

jobs:
  build_and_deploy_job:
    if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.event.action != 'closed')
    runs-on: windows-latest
    name: Build and Deploy Job
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: true
      - name: Build And Deploy
        id: builddeploy
        uses: Azure/web-apps-deploy@v1
        with:
          azure_web_apps_api_token: ${{ secrets.AZURE_WEBAPP_TOKENS }}
          repo_token: ${{ secrets.GITHUB_TOKEN }} # Used for Github integrations (i.e. PR comments)
          action: "upload"
          app_location: "/"
          api_location: "api"
          output_location: "dist/test"


  close_pull_request_job:
    if: github.event_name == 'pull_request' && github.event.action == 'closed'
    runs-on: windows-latest
    name: Close Pull Request Job
    steps:
      - name: Close Pull Request
        id: closepullrequest
        uses: Azure/web-apps-deploy@v1
        with:
          azure_web_apps_api_token: ${{ secrets.AZURE_WEBAPP_TOKENS }}
          action: "close"


#   build:
#     runs-on: windows-latest

#     steps:
#       - uses: actions/checkout@v2

#       - name: Set up Node.js version
#         uses: actions/setup-node@v1
#         with:
#           node-version: '16.x'

#       - name: npm install, build
#         run: |
#           npm install
#           npm run build --prod


#       - name: Upload artifact for deployment job
#         uses: actions/upload-artifact@v2
#         with:
#           name: node-app
#           path: .

#   deploy:
#     runs-on: windows-latest
#     needs: build
#     environment:
#       name: 'Production'
#       url: ${{ steps.deploy-to-webapp.outputs.webapp-url }}

#     steps:
#       - name: Download artifact from build job
#         uses: actions/download-artifact@v2
#         with:
#           name: node-app

#       - name: 'Deploy to Azure Web App'
#         uses: azure/webapps-deploy@v2
#         id: deploy-to-webapp
#         with:
#           app-name: ${{env.AZURE_WEBAPP_NAME}}
#           slot-name: 'Production'
#           publish-profile: ${{ secrets.AZURE_WEBAPP_TOKENS }}
#           package: .

